{% comment %}
  Cart Drawer Items - Lista de produtos no carrinho
{% endcomment %}

<div class="cart-items">
  {% for item in cart.items %}
    <div class="cart-item" data-key="{{ item.key }}">
      <!-- Imagem do Produto -->
      <div class="cart-item__image">
        {% if item.image %}
          <img src="{{ item.image | image_url: width: 120 }}" alt="{{ item.title | escape }}" loading="lazy">
        {% else %}
          <div class="cart-item__image-placeholder">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="3" width="18" height="18" rx="2" stroke="#ccc" stroke-width="2"/>
            </svg>
          </div>
        {% endif %}
      </div>

      <!-- Detalhes do Produto -->
      <div class="cart-item__details">
        <a href="{{ item.url }}" class="cart-item__title">{{ item.product.title }}</a>
        
        {% if item.variant.title != 'Default Title' %}
          <p class="cart-item__variant">{{ item.variant.title }}</p>
        {% endif %}

        {% if item.properties.size > 0 %}
          <div class="cart-item__properties">
            {% for property in item.properties %}
              {% unless property.first contains '_' %}
                <p class="cart-item__property">
                  <strong>{{ property.first }}:</strong> {{ property.last }}
                </p>
              {% endunless %}
            {% endfor %}
          </div>
        {% endif %}

        <!-- Preço -->
        <div class="cart-item__price-wrapper">
          {% if item.original_line_price > item.final_line_price %}
            <span class="cart-item__price-original">{{ item.original_line_price | money }}</span>
            <span class="cart-item__price">{{ item.final_line_price | money }}</span>
            <span class="cart-item__discount">
              -{{ item.original_line_price | minus: item.final_line_price | times: 100 | divided_by: item.original_line_price }}%
            </span>
          {% else %}
            <span class="cart-item__price">{{ item.final_line_price | money }}</span>
          {% endif %}
        </div>

        <!-- Descontos aplicados -->
        {% if item.line_level_discount_allocations.size > 0 %}
          <div class="cart-item__discounts">
            {% for discount in item.line_level_discount_allocations %}
              <span class="cart-item__discount-badge">
                {{ discount.discount_application.title }} (-{{ discount.amount | money }})
              </span>
            {% endfor %}
          </div>
        {% endif %}

        <!-- Controles de Quantidade -->
        <div class="cart-item__quantity">
          <button 
            type="button" 
            class="cart-item__qty-btn" 
            data-qty-change="-1" 
            data-key="{{ item.key }}"
            aria-label="Diminuir quantidade"
            {% if item.quantity <= 1 %}disabled{% endif %}
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          
          <input 
            type="number" 
            class="cart-item__qty-input" 
            value="{{ item.quantity }}" 
            min="1" 
            max="{{ item.variant.inventory_quantity }}"
            data-qty-input
            data-key="{{ item.key }}"
            aria-label="Quantidade"
          >
          
          <button 
            type="button" 
            class="cart-item__qty-btn" 
            data-qty-change="1" 
            data-key="{{ item.key }}"
            aria-label="Aumentar quantidade"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Botão de Remover -->
      <button 
        type="button" 
        class="cart-item__remove" 
        data-remove-item 
        data-key="{{ item.key }}"
        aria-label="Remover produto"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  {% endfor %}
</div>

<style>
  .cart-items {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .cart-item {
    display: grid;
    grid-template-columns: 80px 1fr auto;
    gap: 16px;
    padding: 16px;
    background: #f8f9fa;
    border-radius: 12px;
    position: relative;
  }

  /* Imagem */
  .cart-item__image {
    width: 80px;
    height: 80px;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .cart-item__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .cart-item__image-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    background: #f0f0f0;
  }

  /* Detalhes */
  .cart-item__details {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .cart-item__title {
    font-size: 16px;
    font-weight: 600;
    color: #5A3838;
    text-decoration: none;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .cart-item__title:hover {
    color: #8B4513;
  }

  .cart-item__variant {
    font-size: 14px;
    color: #666;
    margin: 0;
  }

  .cart-item__properties {
    font-size: 13px;
    color: #666;
  }

  .cart-item__property {
    margin: 4px 0;
  }

  /* Preço */
  .cart-item__price-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
  }

  .cart-item__price {
    font-size: 18px;
    font-weight: 700;
    color: #5A3838;
  }

  .cart-item__price-original {
    font-size: 14px;
    color: #999;
    text-decoration: line-through;
  }

  .cart-item__discount {
    font-size: 12px;
    font-weight: 600;
    color: #4CAF50;
    background: #e8f5e9;
    padding: 2px 6px;
    border-radius: 4px;
  }

  /* Descontos */
  .cart-item__discounts {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 4px;
  }

  .cart-item__discount-badge {
    font-size: 12px;
    color: #4CAF50;
    background: #e8f5e9;
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: 600;
  }

  /* Quantidade */
  .cart-item__quantity {
    display: flex;
    align-items: center;
    gap: 8px;
    background: white;
    border-radius: 8px;
    padding: 4px;
    width: fit-content;
  }

  .cart-item__qty-btn {
    width: 32px;
    height: 32px;
    background: transparent;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #5A3838;
    transition: all 0.2s ease;
  }

  .cart-item__qty-btn:hover:not(:disabled) {
    background: #5A3838;
    color: white;
    border-color: #5A3838;
  }

  .cart-item__qty-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .cart-item__qty-input {
    width: 50px;
    height: 32px;
    text-align: center;
    border: none;
    font-size: 16px;
    font-weight: 600;
    color: #5A3838;
    background: transparent;
  }

  .cart-item__qty-input:focus {
    outline: none;
  }

  /* Remove from input number arrows */
  .cart-item__qty-input::-webkit-outer-spin-button,
  .cart-item__qty-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .cart-item__qty-input[type=number] {
    -moz-appearance: textfield;
  }

  /* Botão Remover */
  .cart-item__remove {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 32px;
    height: 32px;
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #666;
    transition: all 0.2s ease;
  }

  .cart-item__remove:hover {
    background: #f44336;
    color: white;
    border-color: #f44336;
  }

  /* Responsive */
  @media (max-width: 480px) {
    .cart-item {
      grid-template-columns: 70px 1fr;
      gap: 12px;
      padding: 12px;
    }

    .cart-item__image {
      width: 70px;
      height: 70px;
    }

    .cart-item__title {
      font-size: 14px;
    }

    .cart-item__price {
      font-size: 16px;
    }

    .cart-item__remove {
      top: 8px;
      right: 8px;
      width: 28px;
      height: 28px;
    }
  }
</style>




